/*
* Bonisa
* http://github.com/zmdy/bonisa
* MIT Licensed
*
* Copyright (C) 2020 Hudson Uriel Ferreira, http://gihub.com/zmdy
*
*/

var Bonisa=function(){"use strict";var e={version:"1.2-alpha",engines:{impress:["div#impress>div.step"],reveal:["div.reveal>div.slides>section","div.reveal>div.slides>section>section"]}},t=500,n="./",i=n+"content/",r=n+"src/";const o=e=>new Promise(t=>setTimeout(t,e));function s(e){var t=new XMLHttpRequest,n=e.file,i=e.callback,r=e.encode;try{t.open("GET",n)}catch(e){return console.error(e),console.log("Attempt failed!"),-1}return t.send(),t.onreadystatechange=function(){if(4===t.readyState)try{i(r?encodeURI(t.responseText):t.responseText)}catch(e){return console.error(e),console.log("No function was passed as argument."),-1}},t}function l(n,i){if(!n)return e.error(),-1;!function(t){var n=t.callback||c,i=t.options||t.configs||{},r=t.delimiters||["---","___","***"],o=i.dependencies||[],s=t.engine||t.framework||t.tool||"reveal",l=t.process||function(){},a=t.themes||t.styles||[],d=t.content||null,u=t.title||"Bonisa Presentation";e.location=window.location.host+"/"+window.location.pathname.replace("/","").split("/")[0]+"/",e.textContent=d,e.title=u,document.title=e.title,e.decode=!0,t.fileFormat=null==t.fileFormat?["md"]:t.fileFormat,e.fileFormat||(e.fileFormat=Array.isArray(t.fileFormat)?t.fileFormat:[t.fileFormat]),e.content=[],e.dependencies=o,e.delimiters={text:r,regexp:[]};for(let t in e.delimiters.text){var p="^";for(let n in e.delimiters.text[t])p+="\\u00"+e.delimiters.text[t].charCodeAt(n).toString(16);e.delimiters.regexp.push(p.replace("^",""))}e.delimiters.regexp=RegExp("^("+e.delimiters.regexp.join("|")+")$","gm"),e.engine=e.engines.hasOwnProperty(s)?s:"reveal",e.callback=n,e.structure=e.engines[e.engine],e.slides={length:0,content:[],lastParent:[]},e.config=i,e.process=l,e.convert={},e.styles=Array.isArray(a)?a:[a]}(i),function(){var t=[],n={md:"marked",adoc:"asciidoctor"};e.wait.innerHTML+="<p>Loading dependencies...</p>";for(let i in e.fileFormat)-1==t.indexOf(n[e.fileFormat[i]])&&t.push(n[e.fileFormat[i]]);e.dependencies=t;for(let t in e.dependencies){var i=document.createElement("script");i.src=r+"libs/"+e.dependencies[t]+"/"+e.dependencies[t]+".min.js",document.head.appendChild(i)}}(),o(t).then(()=>{e.wait.innerHTML+="<p>Creating empty structure...</p>",e.configConvert(),function(){var t=[];for(let c in e.structure){var n=e.structure[c].split(">");for(let c in n){var i,r,o,s=n[c],l={};if(s.split("#")!=s?l.id=s.split("#")[1]:s.split(".")!=s&&(l.class=s.split(".")[1]),i=s.split(/\u0023|\u002e/gm)[0],o=0==c?"body":n[c-1],o+=">"+n[c],r=0==c?"body":t[c-1].selector,!document.querySelector(o)){s=document.createElement(i);for(let e in l)s.setAttribute(e,l[e]);t[c]={element:s,parent:r,selector:o},r=document.querySelector(r),c<e.structure.length&&r.appendChild(s)}}}e.rootStructure=t[0].selector,document.querySelector(e.rootStructure).id+="bonisaRoot",e.structure=t.slice(e.structure.length)}(),e.decode&&(n=decodeURI(n),e.wait.innerHTML+="<p>Decoding text(s) contents.</p>");try{e.callback({content:n})}catch(t){return e.wait.innerHTML+="<strong>Error configuring presentation content! Try reloads the page (F5)!</strong>",console.error(t),-1}o(t).then(()=>{!function(){e.wait.innerHTML+="<p>Finishing presentation...</p>",e.process(),e.stylize(),n=document.createElement("script"),i=document.createElement("link"),n.src=e.LIBS_DIR+e.engine+"/"+e.engine+".min.js",i.rel="stylesheet",i.type="text/css",i.href=e.LIBS_DIR+e.engine+"/"+e.engine+".min.css",document.body.appendChild(n),document.body.appendChild(i),o(t).then(()=>{switch(e.wait.style.display="none",e.engine){case"impress":impress().init(e.config);break;case"reveal":Reveal.initialize(e.config)}});var n,i}(),delete e.configConvert,delete e.location,delete e.slides,delete e.fileContent})})}function c(t){e.wait.innerHTML+="<p>Configuring content...</p>",function(t){t.content=function(t){var n,i={},r=1;n=t.split(e.delimiters.regexp);for(let t in n)""!=n[t].replace(e.delimiters.regexp,"")?(i["slide"+e.slides.length]={content:n[t],level:e.delimiters.text.indexOf(n[r])>=0?e.delimiters.text.indexOf(n[r]):0,isParent:!1},i["slide"+e.slides.length].level>=e.structure.length&&(i["slide"+e.slides.length].level=e.structure.length-1),e.slides.length++):r=t;return i}(t.content);for(let e in t.content)t.content[e].fileFormat=t.fileFormat;Object.assign(e.content,t.content)}(t);for(let i in t.content){var n=t.content[i];n.fileFormat||(n.fileFormat=e.fileFormat[0]),n.content=e.convert[n.fileFormat](n.content),(n=a(n)).parent.appendChild(n.structure)}}function a(t){var n;return t.structure=e.structure[t.level].element.cloneNode(!0),t.structure.innerHTML=t.content,0==t.level?(t.parent=document.querySelector(e.structure[0].parent),e.slides.lastParent[t.level]++,e.slides.content.push(t)):(t.parent=e.slides.lastParent[t.level-1]-1,0==e.slides.content[t.parent].isParent&&(e.slides.content[t.parent].isParent=!0,(n=e.structure[1].element.cloneNode(!0)).innerHTML=e.slides.content[t.parent].structure.cloneNode(!0).innerHTML,e.slides.content[t.parent].structure.innerHTML="",e.slides.content[t.parent].structure.appendChild(n)),t.parent=e.slides.content[t.parent].structure),t}function d(){o(t).then(()=>{for(let t in e.content)e.content[t].structure.className+="bonisa",e.content[t].structure.id+="bonisaSlide"+t.replace(/\D/g,"")})}return e.init=function(c){var a=(c="object"==typeof c?c:{configs:c}).file||null,u=c.content||null,p=c.SLIDE_DIR||null,f=c.CONTENT_DIR||null,m=c.SRC_DIR||null;n=p||n,i=f||i,r=m||r,e.SLIDE_DIR=n,e.CONTENT_DIR=i,e.SRC_DIR=r,e.THEMES_DIR=r+"themes/",e.LIBS_DIR=r+"libs/",e.createWait(),a?(c.fileFormat=[],e.fileContent=[],e.fileFormat=[],async function(n){for(let r in n)n[r]=i+n[r],e.fileFormat.push(n[r].split(".").slice(-1)[0]),s({file:n[r],callback:e.setFileContent,encode:n.length>1}),e.wait.innerHTML+="<p>Reading file "+(parseInt(r)+1)+" of "+n.length+"</p>",await o(t);e.fileContent=encodeURI(e.fileContent.join("\n")),await o(t)}(a=Array.isArray(a)?a:[a]),o(t*a.length).then(()=>{l(e.fileContent,c),d()})):(l(u,c),d())},e.stylize=function(){for(let r in e.styles){var n=document.createElement("link"),i=document.createElement("script");n.rel="stylesheet",n.type="text/css",n.href=e.THEMES_DIR+e.styles[r]+"/"+e.styles[r]+".css",i.src=e.THEMES_DIR+e.styles[r]+"/"+e.styles[r]+".js",document.head.appendChild(n);try{document.head.appendChild(i)}catch(t){console.warn('The requested Bonisa theme "'+e.styles[r]+'" doesn\'t have a related script file - "'+e.styles[r]+'.js"')}try{o(t).then(()=>{("theme_"+e.styles[r])()})}catch(t){console.warn('The requested Bonisa theme "'+e.styles[r]+"\" doesn't have a related script function: theme_"+e.styles[r]+"() not found!")}}},e.configConvert=function(){for(let n in e.fileFormat){var t;switch(e.fileFormat[n]){case"md":t=marked;break;case"adoc":t=Asciidoctor.convert}e.convert[e.fileFormat[n]]||(e.convert[e.fileFormat[n]]=t)}for(let t=0;t<e.structure.length;t++)e.slides.lastParent[t]=0},e.createWait=function(){var t=document.createElement("div");t.id="bonisaWait",t.innerHTML=e.wait||"<p>Preparing presentation...</p>",document.body.style.overflow="hidden",t.style.display="inline-block",t.style.visibility="visible",t.style.width="100%",t.style.height="100%",t.style.textAlign="center",document.body.appendChild(t),e.wait=t},e.error=function(){console.log("%cYou've got an error message, don't you? If you did, read this: ","color: #44d; font-weight: bold; font-size: 1.5em;"),console.log("%cHouston, we've got a problem...\n\n%cIt's kind of... impossible to create a presentation without a text file. To configure it do this:\n\n%cBonisa.init({\n\tfile: 'yourFileName.extension',\n\tdir: 'file/directory/location',\n\tengine: 'engine-name'\n});","color: #111; text-transform: uppercase; font-size: 1.25em; font-weight: bold;","color: #111;","color: #44f; font-family: monospace; padding: 2%;"),alert("ERROR: No input file was selected to create the presentation. Open DevTools (F12) to more details ;)")},e.setFileContent=function(t){e.fileContent.push(t)},e}();
